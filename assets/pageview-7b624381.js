const R="2.15.8",u={"Content-Type":"application/json"},m=({serverURL:e,lang:t,paths:a,signal:s})=>(({serverURL:n,lang:l,paths:i,type:p,signal:g})=>fetch(`${n}/article?path=${encodeURIComponent(i.join(","))}&type=${encodeURIComponent(p.join(","))}&lang=${l}`,{signal:g}).then(r=>r.json()))({serverURL:e,lang:t,paths:a,type:["time"],signal:s}).then(n=>Array.isArray(n)?n:[n]),v=e=>(({serverURL:t,lang:a,path:s,type:n,action:l})=>fetch(`${t}/article?lang=${a}`,{method:"POST",headers:u,body:JSON.stringify({path:s,type:n,action:l})}).then(i=>i.json()))({...e,type:"time",action:"inc"}),c=e=>{const t=((a="")=>a.replace(/\/$/u,""))(e);return/^(https?:)?\/\//.test(t)?t:`https://${t}`},f=e=>{e.name!=="AbortError"&&console.error(e.message)},y=e=>e.dataset.path||e.getAttribute("id"),d=(e,t)=>{t.forEach((a,s)=>{a.innerText=e[s].toString()})},U=({serverURL:e,path:t=window.location.pathname,selector:a=".waline-pageview-count",update:s=!0,lang:n=navigator.language})=>{const l=new AbortController,i=Array.from(document.querySelectorAll(a)),p=r=>{const o=y(r);return o!==null&&t!==o},g=r=>m({serverURL:c(e),paths:r.map(o=>y(o)||t),lang:n,signal:l.signal}).then(o=>d(o,r)).catch(f);if(s){const r=i.filter(h=>!p(h)),o=i.filter(p);v({serverURL:c(e),path:t,lang:n}).then(h=>d(new Array(r.length).fill(h),r)),o.length&&g(o)}else g(i);return l.abort.bind(l)};export{U as pageviewCount,R as version};
